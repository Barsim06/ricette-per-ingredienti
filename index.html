<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ricette per Ingredienti</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
  body {
    background-color: #fff8f0;
  }
  header {
    background-color: #ff7043;
    color: white;
    padding: 2rem 0;
    text-align: center;
  }
  .ingredienti {
    font-size: 0.9rem;
    color: #555;
  }
  .card img {
    height: 180px;
    object-fit: cover;
  }
  #dettagliRicetta {
    margin-top: 2rem;
  }
</style>
</head>
<body>
<header>
  <h1>Ricette per Ingredienti</h1>
  <p>Inserisci gli ingredienti che hai e scopri cosa cucinare</p>
  <a href="preferiti.html" class="btn btn-light mt-2">⭐ Vai ai Preferiti</a>
</header>
<main class="container my-4">
  <div class="row mb-4">
    <div class="col-md-10">
      <input type="text" id="ingredienti" class="form-control" placeholder="Es. pasta, tonno, cipolla" />
    </div>
    <div class="col-md-2">
      <button class="btn btn-warning w-100" onclick="cercaRicette()">Trova Ricette</button>
    </div>
  </div>
  <div class="row" id="risultati"></div>
  <div id="dettagliRicetta"></div>
</main>
<script>
  let ricette = [];

  fetch("recipes.json")
    .then((res) => res.json())
    .then((data) => {
      ricette = data;
    })
    .catch((err) => console.error("Errore caricamento JSON:", err));

  function cercaRicette() {
    const input = document
      .getElementById("ingredienti")
      .value.toLowerCase()
      .split(",")
      .map((i) => i.trim())
      .filter((i) => i !== "");

    const risultati = document.getElementById("risultati");
    risultati.innerHTML = "";
    document.getElementById("dettagliRicetta").innerHTML = "";

    if (input.length === 0) {
      risultati.innerHTML =
        '<div class="col-12 text-center"><p class="text-muted">Inserisci almeno un ingrediente.</p></div>';
      return;
    }

    const filtrate = ricette
      .map((r) => ({
        ...r,
        matchCount: r.ingredienti.filter((ing) => input.includes(ing)).length,
      }))
      .filter((r) => r.matchCount > 0)
      .sort((a, b) => b.matchCount - a.matchCount);

    if (filtrate.length === 0) {
      risultati.innerHTML =
        '<div class="col-12 text-center"><p class="text-muted">Nessuna ricetta trovata.</p></div>';
      return;
    }

    filtrate.forEach((r) => {
      risultati.innerHTML += `
      <div class="col-md-4 mb-3">
        <button class="btn btn-outline-primary w-100" onclick="mostraDettagli('${r.nome}')">
          ${r.nome} (${r.matchCount} ingredienti in comune)
        </button>
      </div>
      `;
    });
  }

  function mostraDettagli(nome) {
    const ricetta = ricette.find((r) => r.nome === nome);
    if (!ricetta) return;

    document.getElementById("dettagliRicetta").innerHTML = `
      <div class="card shadow-sm">
        <img src="${ricetta.immagine}" class="card-img-top" alt="${ricetta.nome}" />
        <div class="card-body">
          <h3>${ricetta.nome}</h3>
          <p><strong>Tempo:</strong> ${ricetta.tempo}</p>
          <p><strong>Difficoltà:</strong> ${ricetta.difficoltà}</p>
          <p><strong>Ingredienti:</strong> ${ricetta.ingredienti.join(", ")}</p>
          <button class="btn btn-warning" onclick="aggiungiPreferito('${ricetta.nome}')">⭐ Aggiungi ai Preferiti</button>
        </div>
      </div>
    `;
  }

  function aggiungiPreferito(nome) {
    let preferiti = JSON.parse(localStorage.getItem("preferiti")) || [];
    if (!preferiti.includes(nome)) {
      preferiti.push(nome);
      localStorage.setItem("preferiti", JSON.stringify(preferiti));
      alert(`"${nome}" aggiunta ai preferiti!`);
    } else {
      alert(`"${nome}" è già nei preferiti.`);
    }
  }
</script>
</body>
</html>
